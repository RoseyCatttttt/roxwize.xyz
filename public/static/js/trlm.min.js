//For pretty-printed code, remove the .min
function init(){const e=window.location.search.substring(1).split("&");for(let t of e){const e=t.split("=");vars[e[0]]=decodeURIComponent(e[1])}if("1"==vars.internalstyle){const e=document.createElement("link");e.rel="stylesheet",e.href="./trlm.css",document.head.appendChild(e)}const t=new XMLHttpRequest;t.open("GET","https://roxwize.xyz/ext/trlm/trlm.xml",!0),t.addEventListener("readystatechange",()=>{if(t.readyState===XMLHttpRequest.DONE)if(200===t.status){titleHeader.textContent=void 0!==vars.title?vars.title:"More cool sites";const e=t.responseXML;let n,r="category yields";if(vars.category){let t="";const l=vars.category.trim().split(",");l.length>1&&(r="categories yield");const i=Array.prototype.slice.call(e.querySelectorAll("category")).map(e=>e.getAttribute("name"));for(let e of l){if(!i.includes(e))return void err(`${e} is not a category`);t+=`category[name=${e}] link,`}t=t.slice(0,-1),n=e.querySelectorAll(t)}else n=e.querySelectorAll("category:not([noinclude=true]) link");if(0===n.length)return void err(`The ${vars.category} ${r} no result :(`);n=Array.prototype.slice.call(n);const l=parseInt(vars.max||(n.length>8?8:n.length));if(l>100||l>n.length)return void err(`That's too many links!! (max ${l>n.length?n.length:"100"})`);if(n.length>2*l){const e=Math.floor(Math.random()*(n.length-l));n=n.slice(e,e+l)}for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e-1));[n[e],n[t]]=[n[t],n[e]]}buildLinks(n,e)}else err(`HTTP code ${t.status} received, check console!!`)}),t.send()}function placeholderLink(e,t){const n={href:e,innerHTML:t,title:t,getAttribute:e=>n[e]};return n}function err(e){titleHeader.textContent=e,buildLinks([placeholderLink("about:blank","File an issue"),placeholderLink("javascript:window.location.reload()","Reload the page")],null)}function buildLinks(e,t){let n="";const r=[];if(e.forEach((e,l)=>{const i=e.getAttribute("id")||e.getAttribute("ref");if(i){if(r.includes(i))return;r.push(i)}if(e.getAttribute("ref")&&(e=t.querySelector(`link[id="${i}"]`)),!e)return;const o=document.createElement("li");o.id=`li-${l}`,o.className="trlmLink",o.innerHTML=`<a href="${e.getAttribute("href")}" title="${e.getAttribute("title")||e.textContent}">${e.innerHTML}</a>`,e.getAttribute("style")&&"1"!==vars.nostyle&&(n+=e.getAttribute("style").replaceAll(/!/g,"#"+o.id)),linkList.appendChild(o)}),"1"!==vars.nostyle){const e=document.createElement("style");e.innerHTML=n,document.head.appendChild(e)}}const titleHeader=document.getElementById("titleheader"),linkList=document.getElementById("links"),vars={};init();